machine:
  python:
    version: 2.7.8

dependencies:
  pre:
   - sudo apt-get update -qq
   - sudo apt-get install -qq python-apt python-pycurl
   - pip install ansible==1.8.2

test:
  override:
    - echo localhost > inventory
    - ansible-playbook --syntax-check -i inventory test.yml
    - ansible-playbook -i inventory playbook.yml --connection=local --sudo timeout: 600
    # Taken from https://servercheck.in/blog/testing-ansible-roles-travis-ci-github
    # Run the role/playbook again, checking to make sure it's idempotent.
    - >
      ansible-playbook -i inventory playbook.yml --connection=local --sudo
      | grep -q 'changed=0.*failed=0'
      && (echo 'Idempotence test: pass' && exit 0)
      || (echo 'Idempotence test: fail' && exit 1) timeout: 600
